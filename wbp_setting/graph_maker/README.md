# Graph Maker API

FastAPI сервер для построения графиков сравнения факта и моделей пластового давления.

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Запуск сервера

### Вариант 1: Через uvicorn напрямую
```bash
cd graph_maker
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### Вариант 2: Через Python
```bash
cd graph_maker
python main.py
```

Сервер будет доступен по адресу: `http://localhost:8000`

## API Endpoints

### POST /api/generate_graphs
Генерирует графики сравнения факта и моделей для всех скважин.

**Request Body:**
```json
{
  "wells": [
    {
      "well_name": "156",
      "fact": {
        "dates": ["2020-01-01", "2020-01-02", ...],
        "wbp": [100.5, 101.2, ...],
        "extremums": [
          {"date": "2020-06-15", "wbp": 120.0, "type": "max"},
          {"date": "2020-12-20", "wbp": 80.0, "type": "min"}
        ]
      },
      "models": {
        "Model_1": {
          "dates": ["2020-01-01", "2020-01-02", ...],
          "wbp": [102.0, 103.1, ...],
          "extremums": [...]
        }
      },
      "quality_metrics": {
        "Model_1": {
          "phase_deviation_days": 5.2,
          "amplitude_deviation": 2.5,
          "max_deviation": 1.8,
          "min_deviation": -0.5
        }
      }
    }
  ]
}
```

**Response:**
- Content-Type: `application/zip`
- Body: ZIP-архив с PNG-графиками

### GET /api/health
Проверка работоспособности сервиса.

**Response:**
```json
{
  "status": "ok",
  "service": "graph_maker"
}
```

## Структура проекта

```
graph_maker/
├── __init__.py          # Инициализация модуля
├── main.py              # Точка входа FastAPI приложения
├── router.py            # API роутер с эндпойнтами
├── schemas.py           # Pydantic схемы данных
├── graph_maker.py       # Логика построения графиков
├── requirements.txt     # Зависимости
└── README.md           # Документация
```

## Особенности графиков

- **Факт**: отображается точками (синие оттенки)
- **Модель**: отображается линией (оранжевые оттенки)
- **Экстремумы**: выделены специальными маркерами (треугольники)
- **Метрики качества**: отображаются в правом нижнем углу
- **Единые оси**: все графики одной скважины имеют одинаковые пределы осей для удобного сравнения

## Цветовая схема

### Факт:
- Данные: синий (#1f77b4)
- Максимумы: зеленый (#2ca02c)
- Минимумы: красный (#d62728)

### Модель:
- Данные: оранжевый (#ff7f0e)
- Максимумы: фиолетовый (#9467bd)
- Минимумы: коричневый (#8c564b)

